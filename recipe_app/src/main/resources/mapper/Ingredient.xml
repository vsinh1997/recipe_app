<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.example.recipe_app.mapper.IngredientMapper">
	
	<!-- 条件 -->
	<sql id="conditions">
		<if test="id != null">
			AND id = #{id, jdbcType=BIGINT}
		</if>
		<if test="recipeId != null">
			AND recipe_id = #{recipeId, jdbcType=BIGINT}
		</if>
		<if test="name != null and name != ''">
			AND name ILIKE CONCAT('%', #{name, jdbcType=VARCHAR}, '%')
		</if>
		<if test="amount != null and amount != ''">
			AND amount = #{amount,jdbcType=BIGINT}
		</if>
		</sql>
	
	<select id="select" parameterType='com.example.recipe_app.dto.IngredientCondDto'
		resultType="com.example.recipe_app.dto.IngredientDto">
		SELECT
			*
		FROM ingredient i
		<where>
			<include refid="conditions"/>
		</where>
	</select>
	
	<select id="selectOne" resultType="com.example.recipe_app.dto.RecipeDto">
		SELECT 
			*
		FROM
			ingredient
		WHERE
		    id = #{id, jdbcType=BIGINT}
	</select>

	<insert id="insert" parameterType="com.example.recipe_app.dto.IngredientDto">
		INSERT INTO
			ingredient (recipe_id, name, amount)
		VALUES(
		       #{recipeId, jdbcType=BIGINT},
		       <if test="name != null and name != ''">
				   #{name, jdbcType=VARCHAR},
			   </if>
		       <if test="name == null or name == ''">
				   NULL,
			   </if>
		       <if test="amount != null and amount != ''">
				   #{amount, jdbcType=VARCHAR},
			   </if>
		       <if test="amount == null or amount == ''">
		       		NULL,
		       </if>
			  )
	</insert>

	<update id="update" parameterType="com.example.recipe_app.dto.IngredientDto">
		UPDATE ingredient
		<set>
			id = #{id, jdbcType=BIGINT},
			recipe_id = #{recipeId, jdbcType=BIGINT},
			<if test="name != null and name != ''">
				name =
			</if>
		</set>
	</update>
	
</mapper>
