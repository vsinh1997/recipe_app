<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.example.recipe_app.mapper.IngredientMapper">
	
	<!-- 全項目-->
	<sql id="columns">
		i.id, i.recipe_id, i.name, i.amount
	</sql>
	
	<!-- プライマリキー -->
	<sql id="primaryKey">
		AND i.id = #{id}
	</sql>
	
	<!-- INSERT用全項目 -->
	<sql id="insertColumns">
		i.id, i.recipe_id, i.name, i.amount
	</sql>
	
	<!-- 条件 -->
	<sql id="conditions">
		<if test="id != null">
			AND i.id = #{id, jdbcType=BIGINT}
		</if>
		<if test="recipeId != null">
			AND i.recipe_id = #{recipeId, jdbcType=BIGINT}
		</if>
		<if test="name != null and name != ''">
			AND i.name ILIKE CONCAT('%', #{name, jdbcType=VARCHAR}, '%')
		</if>
		<if test="amount != null and amount != ''">
			AND i.amount = #{amount,jdbcType=BIGINT}
		</if>
		</sql>
	
	<select id="select" parameterType='com.example.recipe_app.dto.IngredientCondDto'
		resultType="com.example.recipe_app.dto.IngredientDto">
		SELECT
			<include refid="columns" />
		FROM ingredient i
		<where>
			<include refid="conditions"></include>
		</where>
	</select>
	
	<select id="selectOne" resultType="com.example.recipe_app.dto.RecipeDto">
		SELECT 
			<include refid="columns" />
		FROM
			ingredient i 
		<where>
			<include refid="primaryKey"></include>
		</where>
	</select>
	
</mapper>
